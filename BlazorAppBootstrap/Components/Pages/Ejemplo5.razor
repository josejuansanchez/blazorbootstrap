@page "/ejemplo5"
@using System.Globalization
@rendermode InteractiveServer

<h3>Ejemplo 5. Listado de usuarios</h3>

<Grid TItem="Usuario"
      AllowFiltering="true"
      AllowPaging="true"
      AllowSorting="true"
      AllowSelection="true"
      Class="table table-hover table-bordered table-striped"
      DataProvider="UsuariosDataProvider"
      PageSize="5"
      Responsive="true"
      RowKeySelector="u => u.Id"
      SelectedItemsChanged="OnSelectedItemsChanged"
      SelectionMode="GridSelectionMode.Multiple">

    <GridColumns>
        <GridColumn TItem="Usuario" HeaderText="ID" PropertyName="Id" SortKeySelector="u => u.Id">
            @context.Id
        </GridColumn>

        <GridColumn TItem="Usuario" HeaderText="Nombre" PropertyName="Nombre" SortKeySelector="u => u.Nombre">
            @context.Nombre
        </GridColumn>

        <GridColumn TItem="Usuario" HeaderText="Correo electrónico" PropertyName="Email" SortKeySelector="u => u.Email">
            @context.Email
        </GridColumn>

        <GridColumn TItem="Usuario" HeaderText="Fecha de nacimiento" PropertyName="FechaNacimiento" SortKeySelector="u => u.FechaNacimiento">
            @context.FechaNacimiento.ToString("dd/MM/yyyy", CultureInfo.InvariantCulture)
        </GridColumn>
    </GridColumns>

</Grid>

<div class="mt-3">
    <strong>Usuarios seleccionados:</strong> @selectedUsuarios.Count
</div>

@if (selectedUsuarios.Any())
{
    <ul>
        @foreach (var user in selectedUsuarios)
        {
            <li>@user.Nombre (@user.Email)</li>
        }
    </ul>
}

@code {
    private IEnumerable<Usuario> usuarios = default!;
    private HashSet<Usuario> selectedUsuarios = new();

    private async Task<GridDataProviderResult<Usuario>> UsuariosDataProvider(GridDataProviderRequest<Usuario> request)
    {
        if (usuarios is null)
            usuarios = GetUsuarios(); // simula la obtención desde una base de datos o API

        return await Task.FromResult(request.ApplyTo(usuarios));
    }

    private IEnumerable<Usuario> GetUsuarios()
    {
        return new List<Usuario>
        {
            new Usuario { Id = 1, Nombre = "Ana Torres", Email = "ana.torres@example.com", FechaNacimiento = new DateOnly(1990, 3, 14) },
            new Usuario { Id = 2, Nombre = "Luis García", Email = "luis.garcia@example.com", FechaNacimiento = new DateOnly(1988, 7, 9) },
            new Usuario { Id = 3, Nombre = "Marta López", Email = "marta.lopez@example.com", FechaNacimiento = new DateOnly(1995, 12, 25) },
            new Usuario { Id = 4, Nombre = "Carlos Pérez", Email = "carlos.perez@example.com", FechaNacimiento = new DateOnly(1982, 5, 2) },
            new Usuario { Id = 5, Nombre = "Laura Sánchez", Email = "laura.sanchez@example.com", FechaNacimiento = new DateOnly(1999, 10, 21) },
            new Usuario { Id = 6, Nombre = "Javier Ruiz", Email = "javier.ruiz@example.com", FechaNacimiento = new DateOnly(1985, 1, 18) },
            new Usuario { Id = 7, Nombre = "Patricia Gómez", Email = "patricia.gomez@example.com", FechaNacimiento = new DateOnly(1992, 11, 30) },
        };
    }

    private Task OnSelectedItemsChanged(HashSet<Usuario> items)
    {
        selectedUsuarios = items is not null && items.Any() ? items : new();
        return Task.CompletedTask;
    }

    public class Usuario
    {
        public int Id { get; set; }
        public string Nombre { get; set; } = string.Empty;
        public string Email { get; set; } = string.Empty;
        public DateOnly FechaNacimiento { get; set; }
    }
}
